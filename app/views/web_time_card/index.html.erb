<script>
  function getDate(date) {
    rawDate = new Date(date);
    var year = rawDate.getFullYear();
    var month = (rawDate.getMonth() + 1);
    var day = rawDate.getDate();
    return year + "-" + month + "-" + day;
  }

  function getTime(date) {
    rawDate = new Date(date);
    var hour = rawDate.getHours();
    var minutes = rawDate.getMinutes();
    return ("00"+hour).substr(-2) + ":" + ("00"+minutes).substr(-2);
  }

  function addRecord(edit) {
    $.getJSON("/", null, function(data, status) {
      for (i in data) {
        var date_text = "";
        var time_text = "";
        if(edit) {
          date_text = '<td><input type="date" value="' + getDate(data[i].datetime) + '" min="2018-01-01" max="2100-12-31"></td>';
          time_text = '<td><input type="time" value="' + getTime(data[i].datetime) + '" min="00:00" max="23:59"></td>';
        } else {
          date_text = '<td>' + getDate(data[i].datetime) + '</td>';
          time_text = '<td>' + getTime(data[i].datetime) + '</td>';
        }
        var s_text = "";
        if(data[i].status == "start") {
          s_text = '<td class="bg-primary text-white">出社</td>';
        } else {
          s_text = '<td class="bg-dark text-white">退社</td>';
        }
        $("#tbody").append("<tr>" + date_text + time_text + s_text + "</tr>");
      }
    });
  }

  function OnLinkClick() {
    var isEdit = false;
    if($("#edit").text() == "編集") {
      isEdit = true;
    } else {
      isEdit = false;
    }

    $("#tbody").empty();
    addRecord(isEdit);

    $("#edit").empty();
    if(isEdit) {
      $("#edit").append("完了");
    } else {
      $("#edit").append("編集");
    }
  }

  $(window).on('load', function() {
    addRecord();

    $("#edit").append("編集");
  });
</script>

<nav class="navbar fixed-bottom navbar-expand-lg navbar-dark bg-dark" style="height:70px">
  <div class="container">
    <ul class="navbar-nav">
      <li class="nav-item active">
      <a class="nav-link" id="edit" href="javascript:void(0);" onclick="OnLinkClick();"></a>
      </li>
    </ul>

    <% if @edit %>
    <form class="form-inline my-2 my-lg-0">
      <button type="button" class="btn btn-danger btn-block" data-toggle="modal" data-target="#myModal">
        全て削除
      </button>
    </form>
    <% end %>
  </div>
</nav>

<div class=container">
  <div class="row">
    <div class="col-md-4">
      <%= form_with scope: :card, url: "start" , method: :post, local: true do |form| %>
        <%= form.hidden_field :status, :value => @worktype %>
        <% if @worktype == "start" %>
          <%= form.submit "出社", :class => "btn btn-primary btn-block " , :style => "font-size: 500%;" %>
        <% else %>
          <%= form.submit "退社", :class => "btn btn-dark btn-block " , :style => "font-size: 500%;" %>
        <% end %>
        </p>
      <% end %>

      <table class="table">
        <thead>
          <th scope="col">月日</th>
          <th scope="col">時刻</td>
          <th scope="col">状況</th>
        </thead>
        <tbody id="tbody">
        <!--
              <td><input type="date" value="2018-01-01" min="2018-01-01" max="2100-12-31"></td>
              <td><input type="time" value="23:59" min="00:00" max="23:59"></td>
        -->
        </tbody>
      </table>

      <div class="modal" tabindex="-1" role="dialog" id="myModal">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-body">
              <p>本当に削除しますか？</p>
            </div>
            <div class="modal-footer">
              <%= button_to "削除", {action: "delete"}, {:class => "btn btn-danger"} %>
              <button type="button" class="btn btn-secondary" data-dismiss="modal">しない</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
